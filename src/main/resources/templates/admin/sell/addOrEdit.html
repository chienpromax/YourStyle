<!DOCTYPE html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{admin/index.html}"
>
    <head></head>

    <body>
        <section layout:fragment="main">
            <div class="displayNotifications"></div>
            <main id="main" class="main" style="height: 1450px">
                <div class="pagetitle">
                    <h1>Bán hàng</h1>
                    <nav>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html">Trang chủ</a></li>
                            <li class="breadcrumb-item active">Bán hàng tại quầy</li>
                        </ol>
                    </nav>
                </div>
                <!-- End Page Title -->

                <section class="section dashboard">
                    <div class="col-lg-12 col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="container mt-4">
                                    <div class="d-flex justify-content-between">
                                        <h2>Sản phẩm</h2>
                                        <div>
                                            <button class="btn btn-outline-warning">QUÉT QR SẢN PHẨM</button>
                                            <button
                                                class="btn btn-outline-warning"
                                                data-bs-toggle="modal"
                                                data-bs-target="#addProductModal"
                                            >
                                                Thêm sản phẩm
                                            </button>
                                        </div>
                                    </div>
                                    <!-- modal thêm sản phẩm -->
                                    <div
                                        class="modal fade"
                                        id="addProductModal"
                                        tabindex="-1"
                                        data-bs-backdrop="static"
                                        data-bs-keyboard="false"
                                        role="dialog"
                                        aria-labelledby="modalTitleId"
                                        aria-hidden="true"
                                    >
                                        <div
                                            class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl"
                                            role="document"
                                        >
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="modalTitleId">Tìm kiếm sản phẩm</h5>
                                                    <button
                                                        type="button"
                                                        class="btn-close"
                                                        data-bs-dismiss="modal"
                                                        aria-label="Close"
                                                    ></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="d-flex justify-content-between mb-4">
                                                        <div>
                                                            <form id="searchForm">
                                                                <div class="position-relative w-100">
                                                                    <button
                                                                        type="submit"
                                                                        class="position-absolute end-0 top-50 translate-middle-y pe-3 text-warning fw-bold border-0 bg-transparent"
                                                                    >
                                                                        <i class="bi bi-search"></i>
                                                                    </button>
                                                                    <input
                                                                        name="value"
                                                                        class="form-control ps-3"
                                                                        placeholder="Tìm theo tên sản phẩm,mã "
                                                                        style="width: 500px"
                                                                    />
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div>Lọc theo giá</div>
                                                    </div>
                                                    <!-- Lọc sản phẩm -->
                                                    <div class="d-flex align-items-center mb-3">
                                                        <div class="me-3">
                                                            <label for="categorySelect" class="form-label">
                                                                Danh mục
                                                            </label>
                                                            <select class="form-select" id="categorySelect">
                                                                <option value="" disabled>Chọn danh mục</option>
                                                                <th:block th:each="category : ${categories}">
                                                                    <option th:value="${category.categoryId}">
                                                                        [[${category.name}]]
                                                                    </option>
                                                                </th:block>
                                                            </select>
                                                        </div>

                                                        <div class="me-3">
                                                            <label for="colorSelect" class="form-label">Màu sắc</label>
                                                            <select class="form-select" id="colorSelect">
                                                                <option value="" disabled>Chọn màu sắc</option>
                                                                <th:block th:each="color : ${colors}">
                                                                    <option th:value="${color.colorId}">
                                                                        [[${color.colorName}]]
                                                                    </option>
                                                                </th:block>
                                                            </select>
                                                        </div>

                                                        <div>
                                                            <label for="sizeSelect" class="form-label">Kích cỡ</label>
                                                            <select class="form-select" id="sizeSelect">
                                                                <option value="" disabled>Chọn kích cỡ</option>
                                                                <th:block th:each="size : ${sizes}">
                                                                    <option th:value="${size.sizeId}">
                                                                        [[${size.sizeName}]]
                                                                    </option>
                                                                </th:block>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <!-- Lọc sản phẩm -->
                                                    <div class="table-reponsive">
                                                        <table class="table table-group-divider text-center">
                                                            <thead>
                                                                <tr>
                                                                    <th scope="col">Mã</th>
                                                                    <th scope="col">Ảnh</th>
                                                                    <th scope="col">Tên sản phẩm</th>
                                                                    <th scope="col">Danh mục</th>
                                                                    <th scope="col">Màu</th>
                                                                    <th scope="col">Size</th>
                                                                    <th scope="col">Giá</th>
                                                                    <th scope="col">Số lượng hàng</th>
                                                                    <th scope="col"></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody class="dssp">
                                                                <tr
                                                                    th:each="productVariant,iterStat : ${productVariants}"
                                                                    class="align-middle"
                                                                >
                                                                    <input
                                                                        type="hidden"
                                                                        th:value="${productVariant.productVariantId}"
                                                                        class="productVariantId"
                                                                    />
                                                                    <input
                                                                        type="hidden"
                                                                        th:value="${productVariant.product.price}"
                                                                        class="inputPrice"
                                                                    />
                                                                    <td>[[${productVariant.productVariantId}]]</td>
                                                                    <td scope="row" class="position-relative">
                                                                        <img
                                                                            th:src="@{'/admin/img/'+${productVariant.product.image}}"
                                                                            alt=""
                                                                            class="img-fluid rounded-circle object-cover w-100 h-100"
                                                                        />
                                                                        <span
                                                                            class="badge bg-success badge-custom position-absolute top-0 right-0"
                                                                            th:if="${productVariant.product.discount}"
                                                                        >
                                                                            [[${#numbers.formatDecimal(productVariant.product.discount.discountPercent,0,'POINT',0,'COMMA')}]]
                                                                            %
                                                                        </span>
                                                                    </td>
                                                                    <td>[[${productVariant.product.name}]]</td>
                                                                    <td>[[${productVariant.product.category.name}]]</td>
                                                                    <td>
                                                                        <input
                                                                            type="hidden"
                                                                            th:value="${productVariant.color.colorId}"
                                                                            class="colorId"
                                                                        />
                                                                        [[${productVariant.color.colorName}]]
                                                                    </td>
                                                                    <td>
                                                                        <input
                                                                            type="hidden"
                                                                            th:value="${productVariant.size.sizeId}"
                                                                            class="sizeId"
                                                                        />
                                                                        [[${productVariant.size.sizeName}]]
                                                                    </td>

                                                                    <td>
                                                                        <span
                                                                            th:unless="${productVariant.product.discount}"
                                                                        >
                                                                            [[${productVariantFormatedPrices[iterStat.index]['oldPrice']}]]
                                                                        </span>
                                                                        <span
                                                                            th:if="${productVariant.product.discount}"
                                                                            class="text-decoration-line-through d-block"
                                                                        >
                                                                            [[${productVariantFormatedPrices[iterStat.index]['oldPrice']}]]
                                                                        </span>
                                                                        <span
                                                                            th:if="${productVariant.product.discount}"
                                                                            class="text-danger fw-bold"
                                                                        >
                                                                            [[${productVariantFormatedPrices[iterStat.index]['discountedPrice']}]]
                                                                        </span>
                                                                    </td>
                                                                    <td>[[${productVariant.quantity}]]</td>
                                                                    <td class="text-end">
                                                                        <button
                                                                            class="btn btn-outline-primary btn-sm"
                                                                            data-bs-toggle="modal"
                                                                            data-bs-target="#selectProductModal"
                                                                            id="openChildModal"
                                                                            onclick="openChildModal(this)"
                                                                        >
                                                                            Chọn
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- modal thêm sản phẩm -->
                                    <hr class="" />
                                    <div class="table-responsive">
                                        <table class="table table-group-divider text-center">
                                            <thead>
                                                <tr>
                                                    <th scope="col">Ảnh</th>
                                                    <th scope="col">Tên sản phẩm</th>
                                                    <th scope="col">Màu</th>
                                                    <th scope="col">Size</th>
                                                    <th scope="col">Giá</th>
                                                    <th scope="col">Số lượng</th>
                                                    <th scope="col">Thành tiền</th>
                                                    <th scope="col"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="dsOrderDetail">
                                                <tr
                                                    th:each="orderDetail,iterStat : ${orderDetails}"
                                                    class="align-middle"
                                                >
                                                    <input
                                                        type="hidden"
                                                        name=""
                                                        th:value="${order.orderId}"
                                                        id="orderId"
                                                    />
                                                    <td scope="row" class="position-relative">
                                                        <img
                                                            th:src="@{/admin/img/{imageName}(imageName=${orderDetail.productVariant.product.image})}"
                                                            alt=""
                                                            class="img-fluid rounded-circle object-cover"
                                                            style="width: 60px"
                                                        />
                                                        <span
                                                            class="badge bg-success badge-custom position-absolute top-0 right-0"
                                                            th:if="${orderDetail.productVariant.product.discount}"
                                                        >
                                                            [[${#numbers.formatDecimal(orderDetail.productVariant.product.discount.discountPercent,0,'POINT',0,'COMMA')}]]
                                                            %
                                                        </span>
                                                    </td>
                                                    <td>[[${orderDetail.productVariant.product.name}]]</td>
                                                    <td>[[${orderDetail.productVariant.color.colorName}]]</td>
                                                    <td>[[${orderDetail.productVariant.size.sizeName}]]</td>
                                                    <td>
                                                        <span
                                                            th:unless="${orderDetail.productVariant.product.discount}"
                                                        >
                                                            [[${orderDetailFormattedPrices[iterStat.index]['oldPrice']}]]
                                                        </span>
                                                        <span
                                                            th:if="${orderDetail.productVariant.product.discount}"
                                                            class="text-decoration-line-through d-block"
                                                        >
                                                            [[${orderDetailFormattedPrices[iterStat.index]['oldPrice']}]]
                                                        </span>
                                                        <span
                                                            th:if="${orderDetail.productVariant.product.discount}"
                                                            class="text-danger fw-bold"
                                                        >
                                                            [[${orderDetailFormattedPrices[iterStat.index]['discountedPrice']}]]
                                                        </span>
                                                    </td>
                                                    <td>[[${orderDetail.quantity}]]</td>
                                                    <td class="text-danger fw-bold">
                                                        <span th:if="${orderDetail.productVariant.product.discount}">
                                                            [[${orderDetailFormattedPrices[iterStat.index]['discountIntoMoney']}]]
                                                        </span>
                                                        <span
                                                            th:unless="${orderDetail.productVariant.product.discount}"
                                                        >
                                                            [[${orderDetailFormattedPrices[iterStat.index]['intoMoney']}]]
                                                        </span>
                                                    </td>
                                                    <td class="text-end">
                                                        <button
                                                            class="btn btn-outline-danger btn-sm"
                                                            th:onclick="'deleteProduct(' + ${orderDetail.orderDetailId} + ')'"
                                                        >
                                                            Xóa
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td class="fw-bold text-black">Tổng tiền:</td>
                                                    <td class="text-danger fw-bold">[[${totalSum}]]</td>
                                                    <td></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <!-- khách hàng -->
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <h3>Khách hàng</h3>
                                        <div>
                                            <button
                                                class="btn btn-outline-warning"
                                                data-bs-toggle="modal"
                                                data-bs-target="#openModalListCustomer"
                                            >
                                                <i class="fas fa-user"></i>
                                                CHỌN KHÁCH HÀNG
                                            </button>
                                        </div>
                                    </div>
                                    <hr />
                                    <!-- giao hàng  -->
                                    <div class="d-flex justify-content-between align-items-center mt-2 mb-3">
                                        <h5>Tên khách hàng</h5>
                                        <h6 class="">[[${order.customer.fullname}]]</h6>
                                        <div class="form-check form-switch">
                                            <label for="shipping" class="form-check-label fw-bold">Giao hàng</label>
                                            <input id="shipping" class="form-check-input" type="checkbox" />
                                        </div>
                                    </div>
                                    <!-- Tính tiền -->
                                    <div class="row">
                                        <!-- khách hàng và địa chỉ -->
                                        <div class="col-md-7">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <div class="form-floating">
                                                        <input
                                                            type="text"
                                                            class="form-control"
                                                            id="floatinghovaten"
                                                            placeholder="Họ và tên"
                                                        />
                                                        <label for="floatinghovaten">
                                                            <span class="text-danger">*</span>
                                                            Họ và tên
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <div class="form-floating">
                                                        <input
                                                            type="text"
                                                            class="form-control"
                                                            id="floatingsodienthoai"
                                                            placeholder="Số điện thoại"
                                                        />
                                                        <label for="floatingsodienthoai">
                                                            <span class="text-danger">*</span>
                                                            Số điện thoại
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <div class="form-floating">
                                                        <input
                                                            type="text"
                                                            class="form-control"
                                                            id="floatingstreet"
                                                            placeholder="Địa chị cụ thể"
                                                        />
                                                        <label for="floatingstreet">
                                                            <span class="text-danger">*</span>
                                                            Địa chị cụ thể
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <div class="form-floating">
                                                        <input
                                                            class="form-control"
                                                            id="floatingcity"
                                                            placeholder="Tỉnh/thành phố"
                                                        />
                                                        <label for="floatingCity">
                                                            <span class="text-danger">*</span>
                                                            Tỉnh/thành phố
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <div class="form-floating">
                                                        <input
                                                            name=""
                                                            id="floatingdistrict"
                                                            class="form-control"
                                                            placeholder="Quận/huyện"
                                                        />
                                                        <label for="floatingdistrict">
                                                            <span class="text-danger">*</span>
                                                            Quận/huyện
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <div class="form-floating">
                                                        <input
                                                            name=""
                                                            id="floatingward"
                                                            class="form-control"
                                                            placeholder="Xã/phường/thị trấn"
                                                        />

                                                        <label for="floatingward">
                                                            <span class="text-danger">*</span>
                                                            Xã/phường/thị trấn
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- khách hàng và địa chỉ -->
                                        <div class="col-md-5">
                                            <div class="d-flex">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" />
                                                    <label for="">Phiếu giảm giá</label>
                                                </div>
                                                <div class="form-floating ms-2">
                                                    <input type="text" class="form-control" />
                                                    <label for="">Phần trăm giảm</label>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <p>Tiền hàng</p>
                                                <p>[[${totalSum}]]</p>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-1">
                                                <p>Phí vận chuyển</p>
                                                <div>
                                                    <p>32.000 VND</p>
                                                    <hr />
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <p>Giảm giá</p>
                                                <p>300.000 VND</p>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <p class="fw-bold">Tổng số tiền</p>
                                                <p class="text-danger fw-bold">2.000.000 VND</p>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <div class="d-flex p-2">
                                                    <p class="fw-bold">Khách thanh toán:</p>
                                                    <!-- Icon Thanh toán Tiền Mặt -->
                                                    <button
                                                        class="btn border border-dark px-4 py-2 ms-2"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#paymentModal"
                                                    >
                                                        <i class="fas fa-credit-card"></i>
                                                    </button>
                                                </div>
                                                <p class="text-danger fw-bold">0 VND</p>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                                <p class="fw-bold">Tiền thiếu</p>
                                                <p class="text-danger fw-bold">2.000.000 VND</p>
                                            </div>
                                            <div class="text-end">
                                                <button class="btn btn-outline-warning">XÁC NHẬN ĐẶT HÀNG</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
            <!-- modal thanh toán -->
            <div
                class="modal fade"
                id="paymentModal"
                tabindex="-1"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                role="dialog"
                aria-labelledby="modalTitleId"
                aria-hidden="true"
            >
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <form action="" method="post">
                            <div class="modal-header text-center">
                                <h3 class="modal-title" id="modalTitleIdPayment">THANH TOÁN</h3>
                                <button
                                    type="button"
                                    class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="Close"
                                ></button>
                            </div>
                            <div class="modal-body">
                                <div class="d-flex justify-content-between align-items-center px-5">
                                    <h5>Tổng tiền hàng</h5>
                                    <p class="text-danger fw-bold">2.000.000 VND</p>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button
                                        class="btn px-5 py-1 bg-info rounded-bottom-5 text-white me-4"
                                        id="BANK_TRANSFERPayment"
                                    >
                                        CHUYỂN KHOẢN
                                    </button>
                                    <button class="btn px-5 py-1 bg-success text-white" id="CODPayment">
                                        TIỀN MẶT
                                    </button>
                                </div>
                                <div class="form-floating mt-3">
                                    <input id="customerPay" type="text" class="form-control" />
                                    <label for="customerPay">Tiền khách đưa</label>
                                </div>
                                <div class="table-reponsive">
                                    <table class="table table-group-divider text-center">
                                        <thead class="">
                                            <tr>
                                                <th>STT</th>
                                                <th>Mã giao dịch</th>
                                                <th>Phương thức</th>
                                                <th>Số tiền</th>
                                                <th>Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td></td>
                                                <td>Tiền mặt</td>
                                                <td>2.000.000 VND</td>
                                                <td class="text-danger"><i class="fas fa-trash-alt"></i></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <h6 class="fw-bold">Tiền thiếu</h6>
                                    <p class="text-danger fw-bold">2.000.000 VND</p>
                                </div>
                                <hr />
                                <div class="text-center">
                                    <button type="button" class="btn btn-success" id="confirmPayment">XÁC NHẬN</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- modal thanh toán -->
            <!-- modal chọn sản phẩm -->
            <div
                class="modal fade"
                id="selectProductModal"
                tabindex="-1"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                role="dialog"
                aria-labelledby="modalTitleId"
                aria-hidden="true"
            >
                <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <form action="" method="post">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitleId1"></h5>
                                <button
                                    type="button"
                                    class="btn-close"
                                    data-bs-target="#addProductModal"
                                    data-bs-toggle="modal"
                                    aria-label="Close"
                                ></button>
                            </div>
                            <div class="modal-body"></div>
                            <div class="modal-footer">
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    data-bs-toggle="modal"
                                    data-bs-target="#addProductModal"
                                    id="confirmInsertProduct"
                                >
                                    Xác nhận
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- modal chọn sản phẩm -->
            <!-- End #main -->
            <script>
                window.addEventListener("DOMContentLoaded", function () {
                    const orderId = document.getElementById("orderId").value;
                    window.deleteProduct = function (orderDetailId) {
                        console.log("orderDetailId: " + orderDetailId);
                        Swal.fire({
                            title: "Bạn có chắc chắn muốn xóa sản phẩm này không?",
                            text: "",
                            icon: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#3085d6",
                            cancelButtonColor: "#d33",
                            confirmButtonText: "Xác nhận",
                            cancelButtonText: "Hủy",
                        }).then((result) => {
                            if (result.isConfirmed) {
                                fetch(`http://localhost:8080/api/admin/sell/deleteProduct/${orderDetailId}`, {
                                    method: "DELETE",
                                    headers: {
                                        "Content-Type": "application/json",
                                    },
                                })
                                    .then((response) => {
                                        if (response.ok) {
                                            response.text();
                                        }
                                    })
                                    .then((message) => {
                                        createToast(
                                            "success",
                                            "fa-solid fa-circle-check",
                                            "Thành công",
                                            "Xóa sản phẩm thành công"
                                        );
                                        setTimeout(() => {
                                            window.location.href = `/admin/sell/detail/${orderId}`;
                                        }, 1500);
                                    })
                                    .catch((error) => {
                                        createToast(
                                            "error",
                                            "fa-solid fa-circle-exclamation",
                                            "Lỗi",
                                            "Xóa sản phẩm thất bại!"
                                        );
                                        console.log("có lỗi xảy ra: " + error);
                                    });
                            }
                        });
                    };
                    // Nút chọn
                    let colorId;
                    let sizeId;
                    let productVariantId;
                    let price;
                    window.openChildModal = function (button) {
                        const rows = button.closest("tr"); // Nút chọn được nhấn
                        colorId = rows.querySelector(".colorId").value;
                        sizeId = rows.querySelector(".sizeId").value;
                        productVariantId = rows.querySelector(".productVariantId").value;
                        price = rows.querySelector(".inputPrice").value;
                        console.log("colorId " + colorId);
                        console.log("sizeId " + sizeId);
                        console.log("productVariantId " + productVariantId);
                        console.log("price " + price);
                        const productName = rows.cells[2].textContent;
                        const categoryName = rows.cells[3].textContent;
                        const color = rows.cells[4].textContent;
                        const size = rows.cells[5].textContent;
                        // const price = rows.cells[6].textContent;
                        const quantity = rows.cells[7].textContent;
                        // Lấy các phần tử span theo điều kiện có hoặc không có discount
                        const oldPriceElement = rows.querySelector("span:not([class])"); // span không có class, dùng cho oldPrice
                        const discountedPriceElement = rows.querySelector("span.text-danger.fw-bold"); // span dùng cho discountedPrice
                        const lineThroughElement = rows.querySelector("span.text-decoration-line-through.d-block"); // span dùng cho oldPrice khi có discount
                        let oldPrice = lineThroughElement ? lineThroughElement.textContent.trim() : "N/A";
                        let discountedPrice = discountedPriceElement
                            ? discountedPriceElement.textContent.trim()
                            : "N/A";
                        let oldPriceNotDiscount = oldPriceElement ? oldPriceElement.textContent.trim() : "N/A";
                        // Xác định giá nào sẽ hiển thị
                        let modalBodyContent;
                        let modalTitleContent = `<h5>${productName} "${color}"</h5>`;
                        if (discountedPriceElement) {
                            // Nếu có giảm giá
                            modalBodyContent = `
                                    <p><strong>Danh mục:</strong> ${categoryName}</p>
                                    <p>
                                        <strong>Giá:</strong> <span class="text-decoration-line-through">${oldPrice}   </span>
                                        <span class="text-danger fw-bold"> ${discountedPrice}</span>
                                    </p>
                                    <p><strong>Size:</strong> ${size}</p>
                                    <p><strong class="text-danger">Số lượng: ${quantity}</strong>
                                    <input class="" type="number" value="1" min="0" name="inputQuantity" id="inputQuantity"></p>`;
                        } else {
                            // Nếu không có giảm giá
                            modalBodyContent = `
                                    <p><strong>Danh mục:</strong> ${categoryName}</p>
                                    <p>
                                        <strong>Giá:</strong> <span class="text-danger fw-bold">${oldPriceNotDiscount}</span>
                                    </p>
                                    <p><strong>Size:</strong> ${size}</p>
                                    <p><strong class="text-danger">Số lượng: ${quantity}</strong>
                                    <input type="number" value="1" min="0" name="inputQuantity" id="inputQuantity"></p>`;
                        }
                        selectProductModal.querySelector(".modal-title").innerHTML = modalTitleContent;
                        selectProductModal.querySelector(".modal-body").innerHTML = modalBodyContent;
                    };
                    // Id của modal
                    // thêm sản phẩm
                    const selectProductModal = document.getElementById("selectProductModal");
                    window.confirmInsertProduct = function () {
                        const quantity = document.getElementById("inputQuantity").value;
                        console.log("productVariantId " + productVariantId);
                        console.log("orderId " + orderId);
                        console.log("sizeId " + sizeId);
                        console.log("colorId " + colorId);
                        console.log("quantity " + quantity);
                        console.log("price " + price);

                        const orderDetailData = {
                            orderId: orderId,
                            productVariantId: productVariantId,
                            price: price,
                            quantity: quantity,
                            sizeId: sizeId,
                            colorId: colorId,
                        };
                        fetch("/api/admin/sell/addProduct", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(orderDetailData),
                        })
                            .then((reponse) => {
                                if (!reponse.ok) {
                                    throw new Error("Lỗi server không trả dữ liệu về!");
                                }
                                return reponse.text();
                            })
                            .then((message) => {
                                // console.log("Data length:", data.length);
                                // console.log(data);
                                // updateOrderDetailTable(data);
                                createToast("success", "fa-solid fa-circle-check", "Thành công", message);
                                // setTimeout(() => {
                                //     window.location.href = `/admin/sell/detail/${orderId}`;
                                // }, 1500);
                            })
                            .catch((err) => {
                                console.error("Lỗi: " + err);
                                createToast(
                                    "error",
                                    "fa-solid fa-circle-exclamation",
                                    "Lỗi",
                                    "Thêm sản phẩm thất bại!"
                                );
                            });
                    };
                    const confirmButton = document.getElementById("confirmInsertProduct");

                    if (confirmButton) {
                        confirmButton.addEventListener("click", confirmInsertProduct);
                    }
                    function updateOrderDetailTable(orderDetailResponseDtos) {
                        console.log("Updating table with order details:", orderDetailResponseDtos);
                        const tbody = $(".dsorderDetail"); // Chọn tbody
                        tbody.empty(); // Xóa nội dung cũ

                        orderDetailResponseDtos.forEach((dto) => {
                            const orderDetail = dto.orderDetail;
                            const formatedPrices = dto.formatedPrices;
                            const product = dto.product;
                            const discount = dto.discount;
                            const color = dto.color;
                            const size = dto.size;
                            const row = `
                    <tr class="align-middle">
                        <td scope="row" class="position-relative">
                            <img src="/admin/img/${product.image}" alt="" class="img-fluid rounded-circle object-cover" style="width: 60px" />
                            <span class="badge bg-success badge-custom position-absolute top-0 right-0" th:if="${discount}">
                                ${discount.discountPercent} %
                            </span>
                        </td>
                        <td>${product.name}</td>
                        <td>${color.colorName}</td>
                        <td>${size.sizeName}</td>
                        <td>
                            <span th:unless="${discount}">
                                ${formatedPrices.oldPrice}
                            </span>
                            <span th:if="${discount}" class="text-decoration-line-through d-block">
                                ${formatedPrices.oldPrice}
                            </span>
                            <span th:if="${discount}" class="text-danger fw-bold">
                                ${formatedPrices.discountedPrice}
                            </span>
                        </td>
                        <td>${orderDetail.quantity}</td>
                        <td class="text-danger fw-bold">
                            <span th:if="${discount}">
                                ${formatedPrices.discountIntoMoney}
                            </span>
                            <span th:unless="${discount}">
                                ${formatedPrices.intoMoney}
                            </span>
                        </td>
                        <td class="text-end">
                            <button class="btn btn-outline-danger btn-sm">Xóa</button>
                        </td>
                    </tr>
                `;
                            tbody.append(row); // Thêm dòng mới vào tbody
                        });
                    }
                });
            </script>
            <script src="/admin/js/sell.js"></script>
        </section>
    </body>
</html>
<!-- Modal danh sách khách hàng -->
<div
    class="modal fade"
    id="openModalListCustomer"
    tabindex="-1"
    data-bs-backdrop="static"
    data-bs-keyboard="false"
    role="dialog"
    aria-labelledby="modalTitleId"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitleId2">Tìm kiếm khách hàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- search and create staff -->
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <!-- Start Search  -->
                    <div class="position-relative w-50">
                        <a class="position-absolute end-0 top-50 translate-middle-y pe-3" href="#">
                            <i class="bi bi-search"></i>
                        </a>
                        <input class="form-control" placeholder="Nhập tên hoặc email hoặc sdt..." />
                    </div>
                    <!-- End Search  -->
                    <!-- add customer -->
                    <div>
                        <a
                            id="addCustomer"
                            class="btn btn-warning py-lg-1 px-lg-3 rounded-pill text-white ms-3"
                            data-bs-toggle="modal"
                            data-bs-target="#openModalAddCustomer"
                        >
                            <i class="bi bi-plus-circle"></i>
                            Thêm khách hàng
                        </a>
                    </div>
                    <!-- add customer -->
                </div>

                <!-- start list table -->
                <div class="table-responsive">
                    <table class="table table-striped-columns">
                        <thead>
                            <tr>
                                <th scope="col">STT</th>
                                <th scope="col">ID</th>
                                <th scope="col">Họ và tên</th>
                                <th scope="col">Email</th>
                                <th scope="col">SĐT</th>
                                <th scope="col">Ngày sinh</th>
                                <th scope="col">Giới tính</th>
                                <th scope="col">Trạng thái</th>
                                <th scope="col">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="">
                                <td>1</td>
                                <td>KH1</td>
                                <td>Nguyễn Văn A</td>
                                <td>iloveyou@gmail.com</td>
                                <td>0714129312</td>
                                <td>10-08-2003</td>
                                <td>Nam</td>
                                <td>
                                    <span class="badge text-white bg-success">Hoạt động</span>
                                </td>
                                <td class="text-center">
                                    <a style="cursor: pointer; font-size: 21px"><i class="bi bi-eye"></i></a>
                                </td>
                            </tr>
                            <tr class="">
                                <td>2</td>
                                <td>KH2</td>
                                <td>Nguyễn Văn Hoàng</td>
                                <td>hoangmafiainternet@gmail.com</td>
                                <td>0714132112</td>
                                <td>10-05-1999</td>
                                <td>Nam</td>
                                <td>
                                    <span class="badge text-white bg-success">Hoạt động</span>
                                </td>
                                <td class="text-center">
                                    <a style="cursor: pointer; font-size: 21px"><i class="bi bi-eye"></i></a>
                                </td>
                            </tr>
                            <tr class="">
                                <td>3</td>
                                <td>KH3</td>
                                <td>Lê Khánh Huyền</td>
                                <td>huyenbaby@gmail.com</td>
                                <td>0714122312</td>
                                <td>01-02-2000</td>
                                <td>Nữ</td>
                                <td>
                                    <span class="badge text-white bg-success">Hoạt động</span>
                                </td>
                                <td class="text-center">
                                    <a style="cursor: pointer; font-size: 21px"><i class="bi bi-eye"></i></a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- End table-->
                <!-- start pagination -->
                <div class="text-muted d-flex justify-content-between">
                    <form action="">
                        <div class="form-inline">
                            <label for="size">Xem:</label>
                            <select class="px-lg-2 py-lg-1" name="size" id="size" onchange="this.form.submit()">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="30">30</option>
                            </select>
                            <label>Khách hàng</label>
                        </div>
                    </form>
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link">first</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">1</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">2</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">3</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">last</a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!-- end pagination -->
            </div>
        </div>
    </div>
</div>
<!-- modal danh sách khách hàng -->
<!-- Modal thêm khách hàng -->
<div
    class="modal fade"
    id="openModalAddCustomer"
    tabindex="-1"
    data-bs-backdrop="static"
    data-bs-keyboard="false"
    role="dialog"
    aria-labelledby="modalTitleId"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitleId3">Thêm khách hàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-primary">TẠO MỚI</button>
            </div>
        </div>
    </div>
</div>
