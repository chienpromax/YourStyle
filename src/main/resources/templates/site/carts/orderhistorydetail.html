<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{site/index.html}">

<head>
    <title>Lịch sử đơn hàng</title>
    <style>
        .timeline {
            border-left: 3px solid #ddd;
            padding-left: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin-top: 20px;
        }

        .order-status-timeline {
            position: relative;
            height: 10px;
            width: 100%;
            background: linear-gradient(to right, #28a745, #4CAF50, #8BC34A);
            border-radius: 5px;
            overflow: hidden;
        }

        .fill-bar {
            height: 100%;
            width: 0;
            background-color: rgb(238, 255, 0);
            animation: fillAnimation 5s forwards;
            border-radius: 5px;
        }

        .icon-container {
            display: inline-block;
            transition: transform 0.5s;
        }

        .icon-container:hover {
            transform: scale(1.2);
        }

        .order-status i {
            font-size: 1.5em;
            color: #28a745;
        }

        .icon-wrapper .bi-app-indicator {
            color: red;
        }

        .icon-wrapper .bi-check2-square {
            color: red;
        }

        .icon-wrapper.active .bi-app-indicator {
            color: green;
        }

        .icon-wrapper.active .bi-check2-square {
            color: green;
        }

        .hidden {
            display: none;
        }

        .icon-wrapper i {
            font-size: 2em;
            color: red;
        }

        .icon-wrapper.active i.bi-app-indicator {
            display: none;
        }

        .icon-wrapper.active i.bi-check2-square {
            display: inline-block;
            color: green;
        }


    </style>
</head>

<body>
    <!--===== main =======-->
    <section class="py-5 container bg-light" layout:fragment="main">
        <div class="container my-5">
            <a th:href="@{/yourstyle/order/orderhistory}" class="btn btn-link">← Trở Lại</a>
            <section class="py-1 bg-light">
                <div class="order-status row">
                    <div class="order-status-timeline">
                        <div class="fill-bar"></div>
                    </div>
                </div>
            </section>
            <div class="order-status row">
                <!-- Trạng thái đơn hàng -->
                <div class="d-flex justify-content-between mb-4 position-relative">
                    <div class="text-center icon-container">
                        <div class="icon-wrapper">
                            <i class="bi bi-check2-square"></i><br>
                        </div>
                        <i class="bi bi-box-seam"></i><br>
                        Đơn Hàng Đã Đặt <br><small th:text="${order.orderDate}"></small>
                    </div>
                    <div class="text-center icon-container">
                        <div class="icon-wrapper">
                            <i class="bi bi-check2-square"></i><br>
                        </div>
                        <i class="bi bi-house-door"></i><br>
                        ĐANG ĐÓNG GÓI <br>
                    </div>
                    <div class="text-center icon-container">
                        <div class="icon-wrapper">
                            <i class="bi bi-check2-square"></i><br>
                        </div>
                        <i class="bi bi-truck"></i><br>
                        GIAO VẬN CHUYỂN <br>
                    </div>
                    <div class="text-center icon-container">
                        <div class="icon-wrapper">
                            <i class="bi bi-check2-square"></i><br>
                        </div>
                        <i class="bi bi-box-arrow-up"></i><br>
                        ĐANG GIAO HÀNG <br>
                    </div>
                    <div class="text-center icon-container">
                        <div class="icon-wrapper">
                            <i class="bi bi-check2-square"></i><br>
                        </div>
                        <i class="bi bi-currency-dollar"></i><br>
                        ĐÃ THANH TOÁN <br>
                    </div>
                    <div class="text-center icon-container">
                        <div class="icon-wrapper">
                            <i class="bi bi-check2-square"></i><br>
                        </div>
                        <i class="bi bi-star"></i><br>
                        Hoàn Thành <br>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Hiển thị địa chỉ giao hàng -->
                <div class="row d-flex py-5">
                    <div class="text-start col-md-6">
                        <h4><strong>Địa chỉ nhận hàng</strong></h4>
                        <p th:if="${defaultAddress != null}">
                            <span th:text="${customer.fullname}"></span><br>
                            <span th:text="'(+84 )' + ' ' + ${customer.phoneNumber}"></span><br>
                            <span
                                th:text="${defaultAddress.street} + ', ' + ${defaultAddress.district} + ', ' + ${defaultAddress.city} + ', ' + ${defaultAddress.ward}"></span>
                        </p>
                        <p th:if="${defaultAddress == null}">
                            <span>Bạn chưa có địa chỉ.</span>
                        </p>
                    </div>
                    <div class="text-end col-md-6 bg-light">
                        <p>Áp dụng:
                            <span
                                th:text="${order.voucher != null ? order.voucher.voucherName : 'Không có voucher'}"></span>
                        </p>
                        <p>Thành tiền: <span class="text-danger"
                                th:text="${#numbers.formatDecimal(order.totalAmount, 1, 'COMMA', 3, 'POINT') + ' Đ'}"></span>
                        </p>
                        <span
                            th:text="${order.transactionType ?: 'Đang xử lý'} + ' - ' + ${order.transactionStatus ?: ''}"></span>
                        <span class="badge" th:classappend="${order.status == 9 ? 'bg-warning' : 'bg-success'}"
                            th:text="${order.getStatusDescription()}">Status</span>
                        <span id="order-status" th:attr="data-status=${order.getStatusCode()}"></span>
                    </div>
                </div>

                <div th:each="detail : ${orderDetails}">
                    <div class="d-flex py-2">
                        <img th:src="@{'/uploads/' + ${detail.productVariant.product.image}}" alt="Product Image"
                            width="140" class="me-3 img-fluid" />
                        <div>
                            <h6 th:text="${detail.productVariant.product.name}">Tên sản phẩm</h6>
                            <p>Số lượng: <span th:text="${detail.quantity}"></span></p>
                            <p>Giá: <span
                                    th:text="${#numbers.formatDecimal(detail.price, 1, 'COMMA', 3, 'POINT') + ' Đ'}"></span>
                            </p>
                            <a th:href="@{/product/detail/{id}(id=${detail.productVariant.product.productId})}"
                                class="btn">Mua Lại</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const orderStatus = document.getElementById("order-status").getAttribute("data-status") || 9;

                if (orderStatus == 9) {
                    console.log("Status is 9, no progress animation will run.");
                    return;
                }

                const maxStatus = 6;
                const progressWidth = (orderStatus / maxStatus) * 100;

                console.log("Progress Width: ", progressWidth);

                const fillBar = document.querySelector(".fill-bar");
                fillBar.style.transition = "width 2s ease";
                fillBar.style.width = progressWidth + "%";

                const timelineItems = document.querySelectorAll(".icon-wrapper");
                timelineItems.forEach((item, index) => {
                    if (index + 1 <= orderStatus) {
                        item.classList.add("active");
                    } else {
                        item.classList.remove("active");
                    }
                });
            });

        </script>

    </section>
</body>

</html>